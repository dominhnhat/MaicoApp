const fs = require('fs');

module.exports = function patchCollapsible() {
  try {
    var curDir = __dirname;
    var rootDir = process.cwd();
  
    var file = `${rootDir}/node_modules/react-native-collapsible/Collapsible.js`;
    var dataFix =
      "let ref; if (typeof this.contentHandle.measure === 'function') { ref = this.contentHandle; } else { ref = this.contentHandle.getNode(); } ref.measure((x, y, width, height) => {";
    var data = fs.readFileSync(file, 'utf8');
  
    var doLast = 'let ref';
    if (data.indexOf(doLast) !== -1) {
      throw 'Already fixed.';
    }
  
    var result = data.replace(
      'this.contentHandle.getNode().measure((x, y, width, height) => {',
      dataFix,
    );
    fs.writeFileSync(file, result, 'utf8');
    console.log('Android Gradle Fixed!');
  } catch (error) {
    console.error(error);
  }
}


